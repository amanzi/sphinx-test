<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building and Installing Amanzi Using CMake &mdash; Amanzi 0.86-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.86-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Amanzi 0.86-dev documentation" href="../index.html" />
    <link rel="up" title="Building Amanzi" href="index.html" />
    <link rel="next" title="Tutorial" href="../tutorial/index.html" />
    <link rel="prev" title="Amanzi Third Party Library (TPL) Build System" href="building_tpls.html" /> 
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
        extensions: ["mhchem.js"]
    }
  });
</script>

  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img src="../_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../tutorial/index.html" title="Tutorial"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="building_tpls.html" title="Amanzi Third Party Library (TPL) Build System"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Building Amanzi</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building and Installing Amanzi Using CMake</a><ul>
<li><a class="reference internal" href="#building-amanzi">Building Amanzi</a><ul>
<li><a class="reference internal" href="#amanzi-tpl-configuration-settings">Amanzi TPL Configuration Settings</a></li>
<li><a class="reference internal" href="#amanzi-build-configuration-settings">Amanzi Build Configuration Settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing-amanzi">Installing Amanzi</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="building_tpls.html"
                        title="previous chapter">Amanzi Third Party Library (TPL) Build System</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../tutorial/index.html"
                        title="next chapter">Tutorial</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/install/build_instructions.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-and-installing-amanzi-using-cmake">
<h1>Building and Installing Amanzi Using CMake<a class="headerlink" href="#building-and-installing-amanzi-using-cmake" title="Permalink to this headline">¶</a></h1>
<div class="section" id="building-amanzi">
<h2>Building Amanzi<a class="headerlink" href="#building-amanzi" title="Permalink to this headline">¶</a></h2>
<p>Amanzi depends on several external software packages or third party libraries
(TPL) to build. Before building Amanzi a user must either build each of these
TPLs, provide an installation path for each TPL or define the include directories
and libraries needed for each TPL. We recommend that users build Amanzi and all the
TPLs using the <code class="docutils literal"><span class="pre">boostrap.sh</span></code> shell script found in the <code class="docutils literal"><span class="pre">config</span></code> directory.
The script can be run from the source directory. On most
UNIX flavored systems, this script will build and install Amanzi and all the required
TPLs with little information from the user. The script has prerequisites for
compilers, <code class="docutils literal"><span class="pre">LAPACK</span></code>/<code class="docutils literal"><span class="pre">BLAS</span></code> and <code class="docutils literal"><span class="pre">MPI</span></code>. Please read
<a class="reference internal" href="building_tpls.html#tpls"><span class="std std-ref">Amanzi Third Party Library (TPL) Build System</span></a> section for more information and <a class="reference internal" href="building_bootstrap.html#bootstrap"><span class="std std-ref">Quickstart Using Bootstrap</span></a> for installing using the <code class="docutils literal"><span class="pre">bootstrap.sh</span></code>.</p>
<p>We recommended that users install the TPLs in separate directory, since a full TPL build
should be an infrequent task. This is the default behavior of the <code class="docutils literal"><span class="pre">bootstrap.sh</span></code>
script. See <code class="docutils literal"><span class="pre">bootstrap.sh</span> <span class="pre">--help</span></code> for more information on how to
control the installation paths. The TPL build will generate a CMake configuration file
that defines all the required TPL directories and CMake variables to build Amanzi.
Once the user has installed all the required TPLs, the process to build
Amanzi from the command line is:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Generate build files (Makefile, XCode project files, etc.) using CMake</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">C</span> <span class="o">&lt;</span><span class="n">TPL</span> <span class="n">install</span> <span class="n">prefix</span><span class="o">&gt;/</span><span class="n">share</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">amanzi</span><span class="o">-</span><span class="n">tpl</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">cmake</span> \
      <span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_COMPILER</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">mpicc</span> \
      <span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_COMPILER</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">mpicxx</span> \
      <span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_Fortran_COMPILER</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">mpif90</span> \
      <span class="p">[</span><span class="n">Addtional</span> <span class="n">CMake</span> <span class="n">variable</span> <span class="n">definitions</span><span class="p">]</span>
      <span class="o">&lt;</span><span class="n">Amanzi</span> <span class="n">source</span> <span class="n">directory</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Use the build files to build Amanzi, i.e. <code class="docutils literal"><span class="pre">make</span></code>,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
<p>or the user can run <code class="docutils literal"><span class="pre">bootstrap.sh</span></code> defining a previously built TPL configuration with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bootstrap</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">tpl</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">TPL</span> <span class="n">install</span> <span class="n">prefix</span><span class="o">&gt;/</span><span class="n">share</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">amanzi</span><span class="o">-</span><span class="n">tpl</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<div class="section" id="amanzi-tpl-configuration-settings">
<h3>Amanzi TPL Configuration Settings<a class="headerlink" href="#amanzi-tpl-configuration-settings" title="Permalink to this headline">¶</a></h3>
<p>We recommend that users build all the TPLs using the Amanzi SuperBuild project.
This will create a CMake file that will initialize the cache settings for all
the TPLs. Instructions in this section are designed for advanced users.</p>
<p>The Amanzi CMake files search for each TPL through the CMake find_package function.
Each TPL has a search path defined by the variable <code class="docutils literal"><span class="pre">&lt;TPL_Name&gt;_DIR</span></code> where
TPL_Name is the name of the package. The Amanzi CMake files search for the
appropriate include directories and libraries for this package. The search
also includes searching for dependent packages. For example, searching for
ASCEM-IO also triggers a search for HDF5 since ASCEM-IO depends on HDF5.
The exceptions to this variable naming convention are Boost and HDF5. For these
packages, Amanzi uses the CMake FindBoost module found in the CMake installation
and the FindHDF5 module found in the <code class="docutils literal"><span class="pre">tools/cmake/Modules</span></code> directory.</p>
<p>Users can bypass the package search by defining the <code class="docutils literal"><span class="pre">&lt;TPL_Name&gt;_INCLUDE_DIRS</span></code>
and <code class="docutils literal"><span class="pre">&lt;TPL_Name&gt;_LIBRARIES</span></code> variables. These variables should contain the full
path name of the include directories and libraries for that TPL and ANY
dependent package the TPL requires to build and link against. For example,
if you want to bypass the ExodusII search logic, then define
<code class="docutils literal"><span class="pre">ExodusII_INCLUDE_DIRS</span></code> and <code class="docutils literal"><span class="pre">ExodusII_LIBRARIES</span></code> and these variables must
also contain the NetCDF include directories and libraries. These variables
are CMake list types. Each directory or filename should be separated with
a semicolon.</p>
</div>
<div class="section" id="amanzi-build-configuration-settings">
<h3>Amanzi Build Configuration Settings<a class="headerlink" href="#amanzi-build-configuration-settings" title="Permalink to this headline">¶</a></h3>
<p>The naming convention for Amanzi build options is ENABLE_&lt;Feature_Name&gt;
and is a boolean type (ON,OFF). The current build options with the default values
are documented here.</p>
<p>ENABLE_Structured:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">OFF</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Build structured mesh capability.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body">CCSE</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_Unstructured:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">OFF</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Build unstructured mesh capability.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body">At leat one of the mesh frame works, STK, MSTK or MOAB.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_DBC:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">ON</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Enable design by contract build.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_Config_Report:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">ON</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Print out configuration report to the terminal.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_STK_Mesh:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">OFF</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Build the Sierra ToolKit mesh frame work.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body">Trilinos with STK enabled.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_MSTK_Mesh:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">OFF</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Build the MSTK mesh frame work.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body">MSTK</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_MOAB_Mesh:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">OFF</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Build the MOAB mesh frame work.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body">MOAB, requires a specific version. See
Software Requires for more information.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_CCSE_TOOLS:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">OFF</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Build structured AMR post processing tools</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body">python, f2py, gfortran compatible with mpif90</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_UnitTest:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">ON</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Build the unit test test suite.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body">UnitTest++</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>ENABLE_OpenMP:</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">OFF</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">Build Amanzi executables with OpenMP support.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Dependencies:</th><td class="field-body">OpenMP</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="installing-amanzi">
<h2>Installing Amanzi<a class="headerlink" href="#installing-amanzi" title="Permalink to this headline">¶</a></h2>
<p>CMake will generate an <code class="docutils literal"><span class="pre">install</span></code> target in build files. For Makefiles,
<code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code> will install Amanzi under the directory defined by
<code class="docutils literal"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>. The default install location is <code class="docutils literal"><span class="pre">/usr/local</span></code>.</p>
<p>Once installed, other CMake software projects can build and link against Amanzi
as a library.
See <a class="reference external" href="https://software.lanl.gov/ascem/trac/wiki/Amanzi/BuildSystemIntegration">https://software.lanl.gov/ascem/trac/wiki/Amanzi/BuildSystemIntegration</a> for a simple example.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../tutorial/index.html" title="Tutorial"
             >next</a> |</li>
        <li class="right" >
          <a href="building_tpls.html" title="Amanzi Third Party Library (TPL) Build System"
             >previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Building Amanzi</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Amanzi Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>