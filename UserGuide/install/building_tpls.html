<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Amanzi Third Party Library (TPL) Build System &mdash; Amanzi 0.86-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.86-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Amanzi 0.86-dev documentation" href="../index.html" />
    <link rel="up" title="Building Amanzi" href="index.html" />
    <link rel="next" title="Building and Installing Amanzi Using CMake" href="build_instructions.html" />
    <link rel="prev" title="Quickstart Using Bootstrap" href="building_bootstrap.html" /> 
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
        extensions: ["mhchem.js"]
    }
  });
</script>

  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img src="../_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="build_instructions.html" title="Building and Installing Amanzi Using CMake"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="building_bootstrap.html" title="Quickstart Using Bootstrap"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Building Amanzi</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Amanzi Third Party Library (TPL) Build System</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#obtaining-a-supported-compiler">Obtaining A Supported Compiler</a><ul>
<li><a class="reference internal" href="#gcc-on-mac-osx">GCC On Mac OSX</a></li>
<li><a class="reference internal" href="#gcc-on-ubuntu">GCC On Ubuntu</a></li>
<li><a class="reference internal" href="#building-gcc-from-source">Building GCC From Source</a></li>
</ul>
</li>
<li><a class="reference internal" href="#obtaining-mpi">Obtaining MPI</a><ul>
<li><a class="reference internal" href="#mpich2">MPICH2</a></li>
<li><a class="reference internal" href="#openmpi">OpenMPI</a></li>
</ul>
</li>
<li><a class="reference internal" href="#obtaining-lapack-blas">Obtaining LAPACK/BLAS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-tpls-and-amanzi-using-boostrap-sh">Building TPLs and Amanzi Using <code class="docutils literal"><span class="pre">Boostrap.sh</span></code></a></li>
<li><a class="reference internal" href="#building-tpls-from-the-command-line-using-cmake">Building TPLs From The Command Line using CMake</a></li>
<li><a class="reference internal" href="#known-issues">Known Issues</a><ul>
<li><a class="reference internal" href="#netcdf-fails-to-configure-on-mac-osx">NetCDF fails to configure on Mac OSX</a></li>
<li><a class="reference internal" href="#tpl-build-fails-with-any-pgi-compiler">TPL build fails with any PGI compiler</a></li>
<li><a class="reference internal" href="#library-parallelio-ascem-io-missing-archive-index-macosx">Library parallelio (ASCEM-IO) missing archive index (MacOSX)</a></li>
<li><a class="reference internal" href="#fails-to-locate-openssl-in-the-build-curl-step">Fails to locate OpenSSL in the build CURL step</a></li>
</ul>
</li>
<li><a class="reference internal" href="#trilinos-configuration">Trilinos Configuration</a><ul>
<li><a class="reference internal" href="#trilinos-build-configuration-files">Trilinos Build Configuration Files</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="building_bootstrap.html"
                        title="previous chapter">Quickstart Using Bootstrap</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="build_instructions.html"
                        title="next chapter">Building and Installing Amanzi Using CMake</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/install/building_tpls.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="amanzi-third-party-library-tpl-build-system">
<span id="tpls"></span><h1>Amanzi Third Party Library (TPL) Build System<a class="headerlink" href="#amanzi-third-party-library-tpl-build-system" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This project builds the required and optional TPL software for the Amanzi code
project. The build system is designed to configure and build TPLs to the
requirements documented here <a class="reference external" href="https://software.lanl.gov/ascem/trac/wiki/Amanzi/Building/SoftwareRequirements">https://software.lanl.gov/ascem/trac/wiki/Amanzi/Building/SoftwareRequirements</a>.</p>
<p>Users are required to provide the following to build:</p>
<blockquote>
<div><ul class="simple">
<li>A recent and stable GCC or Intel compiler. We have successfully built with
GNU versions 4.7, 4.8, 4.9 and Intel versions 11 through 14.</li>
<li>Mercurial version 1.8 or higher.</li>
<li>CMake version 2.8.8 or higher (including CMake 3.0.x).</li>
<li>MPI installation with compiler wrappers. (mpicc, mpicxx, etc.)</li>
<li>OpenSSL (required to build CURL) installation. This is available on
most UNIX flavored systems and Macs.</li>
<li>BLAS/LAPACK built and tuned to the target architecture. See the
Trilinos Configuration section for more information.</li>
<li>A location to install all the TPLs. The entire software stack
will be installed in directories rooted to this directory. Since the
download&#8211;patch-build-install cycle for each TPL is tied to a single
target, the user must have read and write permission for this location.</li>
<li>The build directory will need approximately 2.1 Gb of space and the
install directory tree requires 300 Mb.</li>
</ul>
</div></blockquote>
<p>On most UNIX-like OS (including Mac OSX) systems, the entire TPL software stack can be built using the <code class="docutils literal"><span class="pre">bootstrap.sh</span></code> shell script found in the config directory. The script searches for CMake and will download and build CMake 2.8.8, if it does not locate the cmake command. The script also searches for a working mpi installation and will download and build OpenMPI 1.4.4 if it does not locate mpi.  At this time, the script does not build compilers, <code class="docutils literal"><span class="pre">LAPACK</span></code> or <code class="docutils literal"><span class="pre">BLAS</span></code>. See the <a class="reference internal" href="#compilers">compilers</a> section on how to obtain a supported compiler and <a class="reference internal" href="#lapack">LAPACK</a> for <code class="docutils literal"><span class="pre">LAPACK</span></code> and <code class="docutils literal"><span class="pre">BLAS</span></code> suggestions. See the <a class="reference internal" href="#mpi">MPI</a> section on how to obtain and install other mpi implementations.</p>
<p>The <code class="docutils literal"><span class="pre">bootstrap.sh</span></code> script will create two build directories, one for the TPLs, TPL_BUILD, and one for amanzi, amanzi-build, in the directory the script is called from. Users can control the install location of the TPLs and Amanzi through command line arguments.  The command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">amanzi</span> <span class="n">source</span> <span class="n">root</span><span class="o">&gt;/</span><span class="n">config</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>will print all the available options and default values.</p>
<p>If a TPL fails to download, configure, build or install,  check the log files
stored under a directory labeled:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">TPL</span> <span class="n">name</span> <span class="n">lowercase</span><span class="o">&gt;/&lt;</span><span class="n">TPL</span> <span class="n">name</span> <span class="n">lowercase</span><span class="o">&gt;-</span><span class="n">timestamps</span><span class="o">.</span>
</pre></div>
</div>
<p>Each step step is recorded with <code class="docutils literal"><span class="pre">STDOUT</span></code> and <code class="docutils literal"><span class="pre">STDERR</span></code> outputs stored
in separate files. Any bug report related to the TPLs should include these log files.</p>
<div class="section" id="obtaining-a-supported-compiler">
<span id="compilers"></span><h3>Obtaining A Supported Compiler<a class="headerlink" href="#obtaining-a-supported-compiler" title="Permalink to this headline">¶</a></h3>
<p>At this time, Amanzi can be built with recent versions of GCC, 4.4 through 4.6, and
Intel versions 11.* and 12.*. Since GCC is widely used by the development team
and it is free, we recommend using one of the supported GCC compilers.</p>
<div class="section" id="gcc-on-mac-osx">
<h4>GCC On Mac OSX<a class="headerlink" href="#gcc-on-mac-osx" title="Permalink to this headline">¶</a></h4>
<p>The default GCC install on Mac OSX does not include a Fortran compiler. Mac users
should use the MacPorts software <a class="reference external" href="http://www.macports.org/">http://www.macports.org/</a> to install GCC. Once
MacPorts is installed,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">port</span> <span class="n">install</span> <span class="n">gcc4x</span>
</pre></div>
</div>
<p>will install GCC 4.x in the /opt/local directory. Be aware that Apple requires these
compiler names to be gcc-mp-4.x, g++-mp-4.x and gfortran-mp-4.x, not the standard names
gcc, g++ and gfortran.</p>
</div>
<div class="section" id="gcc-on-ubuntu">
<h4>GCC On Ubuntu<a class="headerlink" href="#gcc-on-ubuntu" title="Permalink to this headline">¶</a></h4>
<p>Use the apt-get utility,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">gcc</span>
</pre></div>
</div>
</div>
<div class="section" id="building-gcc-from-source">
<h4>Building GCC From Source<a class="headerlink" href="#building-gcc-from-source" title="Permalink to this headline">¶</a></h4>
<p>Please contact your local IT support before attempting to build GCC from source. The binaries may be
available in a non-standard location.</p>
<p>Building GCC requires several precision libraries that must be installed before building GCC.
See <a class="reference external" href="http://gcc.gnu.org/install/prerequisites.html">http://gcc.gnu.org/install/prerequisites.html</a> for more information. Once these
packages are installed, GCC must be configured with C, C++ and Fortran enabled. Documentation
of the available configure options is here <a class="reference external" href="http://gcc.gnu.org/install/configure.html">http://gcc.gnu.org/install/configure.html</a>.
The quickest way to determine the best configure options is to find a similar
machine with a matching OS that has the target GCC already installed, and look at
the verbose version output. The command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>will print out the configure options used to build that GCC compiler. One important note to
remember: DO NOT BUILD GCC IN THE SOURCE DIRECTORY. Create a separate build directory.
The GCC build time is long. On most systems it will need more than 2 hours to complete.</p>
</div>
</div>
<div class="section" id="obtaining-mpi">
<span id="mpi"></span><h3>Obtaining MPI<a class="headerlink" href="#obtaining-mpi" title="Permalink to this headline">¶</a></h3>
<p>Amanzi has been built against both MPICH2 and OpenMPI. Both are easy to build and install,
but on clusters, users should contact their local support before building either one. Many
vendors provide tuned and optimized MPI libraries that should be used to maximize performance.
Otherwise, install either MPICH2 or OpenMPI.</p>
<div class="section" id="mpich2">
<h4>MPICH2<a class="headerlink" href="#mpich2" title="Permalink to this headline">¶</a></h4>
<p>We recommend that users install a stable version of MPICH2. MPICH even minor versions
(Ex: 1.4.1 minor version is 4) are stable. Odd minor versions are beta releases.</p>
<p>Steps to build and install MPICH2 are</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Download MPICH2 <a class="reference external" href="http://www.mcs.anl.gov/research/projects/mpich2/downloads/index.php?s=downloads">http://www.mcs.anl.gov/research/projects/mpich2/downloads/index.php?s=downloads</a></p>
</li>
<li><p class="first">Unpack the tar file and create a separate build directory. In this build directory,
configure MPICH2 with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">configure</span> <span class="o">--</span><span class="n">prefix</span><span class="o">=&lt;</span><span class="n">install</span> <span class="n">prefix</span><span class="o">&gt;</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">f77</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">fc</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">cxx</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">romio</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">shared</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">static</span> \
          <span class="n">CC</span><span class="o">=&lt;</span><span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">C</span> <span class="n">compiler</span><span class="o">&gt;</span>
          <span class="n">CXX</span><span class="o">=&lt;</span><span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">C</span><span class="o">++</span> <span class="n">compiler</span><span class="o">&gt;</span>
          <span class="n">FC</span><span class="o">=&lt;</span><span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">Fortran</span> <span class="n">compiler</span><span class="o">&gt;</span>
          <span class="n">F77</span><span class="o">=&lt;</span><span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">Fortran</span> <span class="n">compiler</span> <span class="n">that</span> <span class="n">support</span> <span class="n">F77</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Build, test and install. MPICH does not support parallel builds.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="nb">all</span><span class="p">;</span> <span class="n">make</span> <span class="n">test</span><span class="p">;</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p class="first">Set environment variables, PATH, LD_LIBRARY_PATH on UNIX/Linux system:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>setenv PATH &lt;install prefix&gt;/bin:${PATH}
setenv LD_LIBRARY_PATH &lt;install prefix&gt;/lib:${LD_LIBRARY_PATH}
</pre></div>
</div>
<p>or for <code class="docutils literal"><span class="pre">bash</span></code> shells:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>export PATH=&lt;install prefix&gt;/bin:${PATH}
export LD_LIBRARY_PATH=&lt;install prefix&gt;/lib:${LD_LIBRARY_PATH}
</pre></div>
</div>
<p>For  Mac OSX, set PATH and DYLD_LIBRARY_PATH environment variables:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>setenv PATH &lt;install prefix&gt;/bin:${PATH}
setenv DYLD_LIBRARY_PATH &lt;install prefix&gt;/lib:${DYLD_LIBRARY_PATH}
</pre></div>
</div>
<p>or for <code class="docutils literal"><span class="pre">bash</span></code> shells:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>export PATH=&lt;install prefix&gt;/bin:${PATH}
export DYLD_LIBRARY_PATH=&lt;install prefix&gt;/lib:${DYLD_LIBRARY_PATH}
</pre></div>
</div>
</li>
<li><p class="first">Set environment variable MPI_ROOT. The <code class="docutils literal"><span class="pre">bootstrap.sh</span></code> script searches for compiler wrappers in this
directory when this is set.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">setenv</span> <span class="n">MPI_ROOT</span> <span class="o">&lt;</span><span class="n">install</span> <span class="n">prefix</span><span class="o">&gt;</span> <span class="ow">or</span> <span class="n">export</span> <span class="n">MPI_ROOT</span><span class="o">=&lt;</span><span class="n">install</span> <span class="n">prefix</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="openmpi">
<h4>OpenMPI<a class="headerlink" href="#openmpi" title="Permalink to this headline">¶</a></h4>
<p>Steps to build and install OpenMPI are</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Download OpenMPI <a class="reference external" href="http://www.open-mpi.org">http://www.open-mpi.org</a></p>
</li>
<li><p class="first">Unpack the tar file in a directory and create a separate build directory. In this build directory
configure OpenMPI with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">configure</span> \
          <span class="o">--</span><span class="n">prefix</span><span class="o">=&lt;</span><span class="n">install</span> <span class="n">prefix</span><span class="o">&gt;</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">mpi</span><span class="o">-</span><span class="n">f77</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">mpi</span><span class="o">-</span><span class="n">f90</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">mpi</span><span class="o">-</span><span class="n">cxx</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">shared</span> \
          <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">static</span> \
          <span class="n">CC</span><span class="o">=&lt;</span><span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">C</span> <span class="n">compiler</span><span class="o">&gt;</span>
          <span class="n">CXX</span><span class="o">=&lt;</span><span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">C</span><span class="o">++</span> <span class="n">compiler</span><span class="o">&gt;</span>
          <span class="n">FC</span><span class="o">=&lt;</span><span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">Fortran</span> <span class="n">compiler</span><span class="o">&gt;</span>
          <span class="n">F77</span><span class="o">=&lt;</span><span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">Fortran</span> <span class="n">compiler</span> <span class="n">that</span> <span class="n">support</span> <span class="n">F77</span><span class="o">&gt;</span><span class="p">,</span>
</pre></div>
</div>
<p>where the compilers are defined explicitly on the command line.</p>
</li>
<li><p class="first">Build, test and install. OpenMPI does support parallel builds.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="nb">all</span><span class="p">;</span> <span class="n">make</span> <span class="n">test</span><span class="p">;</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p class="first">Set environment variables, PATH, LD_LIBRARY_PATH on UNIX/Linux system:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>setenv PATH &lt;install prefix&gt;/bin:${PATH}
setenv LD_LIBRARY_PATH &lt;install prefix&gt;/lib:${LD_LIBRARY_PATH}
</pre></div>
</div>
<p>or for <code class="docutils literal"><span class="pre">bash</span></code> shells:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>export PATH=&lt;install prefix&gt;/bin:${PATH}
export LD_LIBRARY_PATH=&lt;install prefix&gt;/lib:${LD_LIBRARY_PATH}
</pre></div>
</div>
<p>For  Mac OSX, set PATH and DYLD_LIBRARY_PATH environment variables:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>setenv PATH &lt;install prefix&gt;/bin:${PATH}
setenv DYLD_LIBRARY_PATH &lt;install prefix&gt;/lib:${DYLD_LIBRARY_PATH}
</pre></div>
</div>
<p>or for <code class="docutils literal"><span class="pre">bash</span></code> shells:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>export PATH=&lt;install prefix&gt;/bin:${PATH}
export DYLD_LIBRARY_PATH=&lt;install prefix&gt;/lib:${DYLD_LIBRARY_PATH}
</pre></div>
</div>
</li>
<li><p class="first">Set environment variable MPI_ROOT. The bootstrap.sh script searches for compiler wrappers in this
directory when this is set.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">setenv</span> <span class="n">MPI_ROOT</span> <span class="o">&lt;</span><span class="n">install</span> <span class="n">prefix</span><span class="o">&gt;</span> <span class="ow">or</span> <span class="n">export</span> <span class="n">MPI_ROOT</span><span class="o">=&lt;</span><span class="n">install</span> <span class="n">prefix</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="obtaining-lapack-blas">
<span id="lapack"></span><h3>Obtaining LAPACK/BLAS<a class="headerlink" href="#obtaining-lapack-blas" title="Permalink to this headline">¶</a></h3>
<p>Most systems have <code class="docutils literal"><span class="pre">LAPACK</span></code> and <code class="docutils literal"><span class="pre">BLAS</span></code> installed in system directories.
Building these libraries from source and optimizing for the target machine is difficult.
We recommend that users attempt to build Amanzi before building <code class="docutils literal"><span class="pre">LAPACK</span></code> and <code class="docutils literal"><span class="pre">BLAS</span></code> from
source. Trilnos, the package that requires both, detects the libraries in their build system
and in many cases finds them automatically. If the Trilinos build system fails to find the
libraries or if the user wants to build against non-standard <code class="docutils literal"><span class="pre">LAPACK</span></code>/<code class="docutils literal"><span class="pre">BLAS</span></code> distributions,
please read the <a class="reference internal" href="#trilinos">Trilinos</a> configuration section.</p>
<p>If the user must build <code class="docutils literal"><span class="pre">LAPACK</span></code> and <code class="docutils literal"><span class="pre">BLAS</span></code> from source, we recommend <code class="docutils literal"><span class="pre">ATLAS</span></code>, a sofware package
that automatically builds tuned <code class="docutils literal"><span class="pre">BLAS</span></code> libraries and a small subset of <code class="docutils literal"><span class="pre">LAPACK</span></code>. By default
<code class="docutils literal"><span class="pre">ATLAS</span></code> does not build a full <code class="docutils literal"><span class="pre">LAPACK</span></code> distribution, but Amanzi requires a full <code class="docutils literal"><span class="pre">LAPACK</span></code> library.
Read the <code class="docutils literal"><span class="pre">ATLAS</span></code> documentation on how to build <code class="docutils literal"><span class="pre">ATLAS</span></code> with a full <code class="docutils literal"><span class="pre">LAPACK</span></code> installation.
<code class="docutils literal"><span class="pre">ATLAS</span></code> downloads are available at <a class="reference external" href="http://math-atlas.sourceforge.net">http://math-atlas.sourceforge.net</a>.</p>
</div>
</div>
<div class="section" id="building-tpls-and-amanzi-using-boostrap-sh">
<h2>Building TPLs and Amanzi Using <code class="docutils literal"><span class="pre">Boostrap.sh</span></code><a class="headerlink" href="#building-tpls-and-amanzi-using-boostrap-sh" title="Permalink to this headline">¶</a></h2>
<p>The script <code class="docutils literal"><span class="pre">bootstrap.sh</span></code> is located in the <code class="docutils literal"><span class="pre">config</span></code> directory.  See <code class="docutils literal"><span class="pre">bootstrap.sh</span> <span class="pre">--help</span></code> for a full list of options and default settings.  The script will create two subdirectories in the currect directory.  The first is TPL_BUILD used for downloading and builing the TPLs.  The second is amanzi-build used for building Amanzi.  The TPLs and Amanzi will be installed in the directory specified by the option <code class="docutils literal"><span class="pre">--prefix</span></code>.</p>
<p>See the <a class="reference internal" href="building_bootstrap.html#bootstrap"><span class="std std-ref">Quickstart Using Bootstrap</span></a> section for instructions building using <code class="docutils literal"><span class="pre">Bootstrap.sh</span></code>.</p>
</div>
<div class="section" id="building-tpls-from-the-command-line-using-cmake">
<h2>Building TPLs From The Command Line using CMake<a class="headerlink" href="#building-tpls-from-the-command-line-using-cmake" title="Permalink to this headline">¶</a></h2>
<p>We recommend that users run the provided <code class="docutils literal"><span class="pre">bootstrap.sh</span></code> script in the <code class="docutils literal"><span class="pre">config</span></code> directory, to build
the TPLs. The instructions in this section are for advanced users and developers.</p>
<p>The steps to build entire suite of TPL software from the command line are</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Configure with cmake:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cmake</span>  \
       <span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_COMPILER</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">mpicc</span> \
       <span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_COMPILER</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">mpicxx</span> \
       <span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_Fortran_COMPILER</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">mpif90</span> \
       <span class="o">-</span><span class="n">D</span> <span class="n">TPL_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">tpls</span>
       <span class="o">/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">amanzi</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">SuperBuild</span>
</pre></div>
</div>
</li>
<li><p class="first">Build with make (in parallel if desired):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="n">n</span>
</pre></div>
</div>
<p>where n is the number of make jobs.</p>
</li>
<li><p class="first">Install with make:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
<p>The final step, make install, copies a CMake configuration file,amanzi-tpl-config.cmake,
to the install location under share/cmake that is useful when building Amanzi.
Passing this configuration to cmake using the -C option defines all the TPL locations
needed to build amanzi.</p>
<p>For example</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">C</span> <span class="o">/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">amanzi</span><span class="o">-</span><span class="n">tpl</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">cmake</span> \
  <span class="p">[</span><span class="n">Additional</span> <span class="n">CMake</span> <span class="n">opts</span><span class="p">]</span> <span class="o">/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">amanzi</span>
</pre></div>
</div>
<p>will build and link amanzi linked against the TPLs built with this
project, reducing the need for complicated build scripts.</p>
</div>
<div class="section" id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<div class="section" id="netcdf-fails-to-configure-on-mac-osx">
<h3>NetCDF fails to configure on Mac OSX<a class="headerlink" href="#netcdf-fails-to-configure-on-mac-osx" title="Permalink to this headline">¶</a></h3>
<p>This problem occurs when a user has HDF5 installed through MacPorts and uses
the MacPorts OpenMPI. This is an issue with NetCDF&#8217;s configure script which
does not allow the user to control the HDF5 prefix installation. Users can either
install OpenMPI in another directory and use the wrappers in that directory (RECOMMENDED)
or set ENABLE_NetCDF4:BOOL=FALSE while configuring SuperBuild from the command line.</p>
</div>
<div class="section" id="tpl-build-fails-with-any-pgi-compiler">
<h3>TPL build fails with any PGI compiler<a class="headerlink" href="#tpl-build-fails-with-any-pgi-compiler" title="Permalink to this headline">¶</a></h3>
<p>We have not found a PGI C++ compiler that builds our Boost configuration
successfully. TPL build system has successfully built with GCC 4.7, 4.8, 4.9 and
and Intel 11.* through Intel 14.*.</p>
</div>
<div class="section" id="library-parallelio-ascem-io-missing-archive-index-macosx">
<h3>Library parallelio (ASCEM-IO) missing archive index (MacOSX)<a class="headerlink" href="#library-parallelio-ascem-io-missing-archive-index-macosx" title="Permalink to this headline">¶</a></h3>
<p>This bug has only been reported on Macs. Users will experience this bug
when linking the HDF5 test binaries in the Amanzi test suite. Despite a kludge
in the shell script to address this when building ASCEM-IO, this problem persists.
The work-around is to run ranlib on the installed libparallelio.a library.</p>
</div>
<div class="section" id="fails-to-locate-openssl-in-the-build-curl-step">
<h3>Fails to locate OpenSSL in the build CURL step<a class="headerlink" href="#fails-to-locate-openssl-in-the-build-curl-step" title="Permalink to this headline">¶</a></h3>
<p>CURL needs the location of OpenSSL to enable downloads from secure sites.
There is a find_package call in the CURL build definition that attempts
to find the system OpenSSL. If this find fails, define the installation
location of OpenSSL with <code class="docutils literal"><span class="pre">-D</span> <span class="pre">OPENSSL_ROOT_DIR:FILEPATH=&lt;directory&gt;</span></code> when
configuring and rerun cmake.</p>
</div>
</div>
<div class="section" id="trilinos-configuration">
<span id="trilinos"></span><h2>Trilinos Configuration<a class="headerlink" href="#trilinos-configuration" title="Permalink to this headline">¶</a></h2>
<p>Amanzi relies on Trilinos for basic distributed data structures, input file
handling and non-linear solvers. It is critical, for performance reasons, that
the Trilinos build point to tuned BLAS and LAPACK libraries. On most systems,
the BLAS and LAPACK libraries are found in standard system libraries
(/usr/lib or /usr/lib64).  However on large scale clusters these libraries
are typically generic implementations and will not provide optimal performance.
Such machines have tuned BLAS/LAPACK libraries. Please consult the support
documentation for these machines to find the recommended libraries.</p>
<p>To guide the search for BLAS/LAPACK libraries, add <code class="docutils literal"><span class="pre">-D</span> <span class="pre">ENABLE_BLA_Search:BOOL=TRUE</span></code>
to your cmake options. The CMake mechanism (FindBLAS and FindLAPACK) searches through
a list of known vendor supplied BLAS/LAPACK libraries.
Unless, <code class="docutils literal"><span class="pre">BLA_VENDOR</span></code> is set, all possible vendors
are searched, and the search ceases once a valid BLAS/LAPACK library is found. For the
search to be successful, the library must be located in a standard installation location or
defined in the user&#8217;s environment variables <code class="docutils literal"><span class="pre">LD_LIBRARY_PATH</span></code> or <code class="docutils literal"><span class="pre">DYLD_LIBRARY_PATH</span></code>.</p>
<p>Supported BLAS/LAPACK Vendors:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Vendor</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>ATLAS</td>
<td>Automatically Tuned Linear Algebra Software</td>
</tr>
<tr class="row-odd"><td>PhiPACK</td>
<td>PHiPAC (Portable High Performance ANSI C)</td>
</tr>
<tr class="row-even"><td>CXML</td>
<td>HP Libraries</td>
</tr>
<tr class="row-odd"><td>DXML</td>
<td>??</td>
</tr>
<tr class="row-even"><td>SunPerf</td>
<td>Sun Performance Libraries</td>
</tr>
<tr class="row-odd"><td>SCSL</td>
<td>SGI/Cray Performance Libraries</td>
</tr>
<tr class="row-even"><td>SGIMATH</td>
<td>??</td>
</tr>
<tr class="row-odd"><td>IBMESSL</td>
<td>??</td>
</tr>
<tr class="row-even"><td>ACML</td>
<td>AMD Core Math Library</td>
</tr>
<tr class="row-odd"><td>ACML_MP</td>
<td>AMD Core Math Library multi-threaded</td>
</tr>
<tr class="row-even"><td>Apple</td>
<td>Mac OSX Accelerate Framework</td>
</tr>
<tr class="row-odd"><td>NAS</td>
<td>??</td>
</tr>
<tr class="row-even"><td>Intel10_32</td>
<td>Intel MKL with 32bit int</td>
</tr>
<tr class="row-odd"><td>Intel10_64lp</td>
<td>Intel MKL with 64bit int</td>
</tr>
<tr class="row-even"><td>Intel</td>
<td>Older versions of MKL</td>
</tr>
<tr class="row-odd"><td>Generic</td>
<td>Generic BLAS</td>
</tr>
</tbody>
</table>
<p>If the search fails during the TPL configuration or if the Trilinos configuration
fails to locate these libraries, the user can override the search by explicitly
defining the libraries with <code class="docutils literal"><span class="pre">BLAS_LIBRARIES</span></code> and <code class="docutils literal"><span class="pre">LAPACK_LIBRARIES</span></code> at
configuration time. Multiple library names should be
separated with a semi-colon. In some cases, Intel&#8217;s MKL libraries, require
additional link flags when building Amanzi. Use the <code class="docutils literal"><span class="pre">CMAKE_EXE_LINKER_FLAGS</span></code>
configuration variable to define these additional link flags when building Amanzi.
Consult the documentation for the particular library for more information.</p>
<div class="section" id="trilinos-build-configuration-files">
<h3>Trilinos Build Configuration Files<a class="headerlink" href="#trilinos-build-configuration-files" title="Permalink to this headline">¶</a></h3>
<p>SuperBuild contains Trilinos CMake configuration files for specific platforms and
compilers. The files are located under the tpl-build/cmake directory.
The file name should be defined while configuring tpl-build with the option
<code class="docutils literal"><span class="pre">-D</span> <span class="pre">Trilinos_Build_Config_File:STRING=&lt;file&gt;</span></code>. This configuration file will
be the last CMake configuration variable passed to Trilinos, thus all the
definitions in this file will override previous configuration definitions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Hopper (NERSC):</th><td class="field-body"><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Compiler:</th><td class="field-body">Intel</td>
</tr>
<tr class="field-even field"><th class="field-name">Config File:</th><td class="field-body">trilinos-build-libsci-intel.cmake</td>
</tr>
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Defines the LibSci libraries as BLAS/LAPACK
libraries.</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Hopper (NERSC):</th><td class="field-body"><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Compiler:</th><td class="field-body">GNU</td>
</tr>
<tr class="field-even field"><th class="field-name">Config File:</th><td class="field-body">trilinos-build-libsci-gnu.cmake</td>
</tr>
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Defines the LibSci libraries as BLAS/LAPACK
libraries.</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="build_instructions.html" title="Building and Installing Amanzi Using CMake"
             >next</a> |</li>
        <li class="right" >
          <a href="building_bootstrap.html" title="Quickstart Using Bootstrap"
             >previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Building Amanzi</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Amanzi Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>